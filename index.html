<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Bagvoyage</title>

  <!-- Icons / PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="img/bagvoyage-icon-32.png" />
  <link rel="apple-touch-icon" href="img/bagvoyage-icon-180.png" />
  <link rel="manifest" href="manifest.json" />

  <!-- Theme Colors -->
  <meta name="theme-color" content="#1aa3ff" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Fonts & ZXing -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/@zxing/browser@latest"></script>

  <!-- App CSS -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Splash -->
  <div id="splash">
    <div class="wrap">
      <img src="img/bagvoyage-icon-192.png" alt="Bagvoyage logo" />
      <h1>Bagvoyage</h1>
    </div>
  </div>

  <!-- Pull-to-refresh indicator -->
  <div id="ptrIndicator" aria-hidden="true">↓ Release to refresh</div>

  <!-- Saved ✓ overlay -->
  <div id="savedTick" class="saved-tick" aria-hidden="true">✔</div>

  <!-- Hidden input (kept for compatibility; we no longer focus it in HID mode) -->
  <input id="scannerInput"
         type="text"
         autocomplete="off"
         autocapitalize="off"
         spellcheck="false"
         tabindex="-1"
         readonly
         aria-hidden="true"
         style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px" />

  <div class="app" role="application" aria-label="Bagvoyage">
    <div class="hdr">
      <div class="brand">
        <!-- Simple suitcase + check -->
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <title>Suitcase with checkmark</title>
          <rect x="5" y="7" width="14" height="12" rx="2" ry="2" fill="none" stroke="#1aa3ff" stroke-width="2"/>
          <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" fill="none" stroke="#1aa3ff" stroke-width="2"/>
          <path d="M8 13l2.2 2.2L16 9.5" fill="none" stroke="#00cc88" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Bagvoyage</span>
      </div>
      <div class="right">
        <span class="chip"><span id="dbDot" class="dot"></span><span id="dbLabel">DB: checking…</span></span>
        <span class="chip"><span id="camDot" class="dot"></span><span id="camLabel">Camera: idle</span></span>
        <button id="btnDetails" class="btn ghost sm" title="Open bag details">Details</button>
      </div>
    </div>

    <!-- NEW: Setup screen -->
    <div id="setup" class="main setup">
      <form id="setupForm" class="card">
        <div class="card-title">Pre-flight Setup</div>
        <div class="row">
          <label for="setupDate">Date</label>
          <input id="setupDate" type="date" required />
        </div>
        <div class="row">
          <label for="setupFlight">Flight number</label>
          <input id="setupFlight" type="text" placeholder="e.g., MU235 / Q2 101" required />
        </div>
        <div class="row">
          <label for="setupClient">Client</label>
          <input id="setupClient" list="clientList" placeholder="e.g., VIP / VVIP / CIP / Airline" required />
          <datalist id="clientList">
            <option value="VIP"></option>
            <option value="VVIP"></option>
            <option value="CIP Standard"></option>
            <option value="CIP Premium"></option>
            <option value="Airline"></option>
          </datalist>
        </div>
        <div class="row inline">
          <label class="sr-only">Remember session</label>
          <label class="chk"><input id="setupRemember" type="checkbox" checked /> Remember for today</label>
        </div>
        <div class="actions">
          <button class="btn ghost" type="button" id="setupDetails">Bag details…</button>
          <div class="spacer"></div>
          <button class="btn primary" type="submit">Continue</button>
        </div>
      </form>
    </div>

    <!-- Home (scan mode chooser) -->
    <div id="home" class="main home hidden">
      <div class="stack">
        <div class="session-pill" id="sessionPill" title="Current session"></div>
        <button id="btnTag" class="btn primary">Tag — Start scanning</button>
        <button id="btnRetrieve" class="btn ghost">Retrieve — Scan to verify</button>
        <button id="btnManual" class="btn ghost">Manual entry</button>
        <button id="btnOpenDetails" class="btn ghost">Bag details…</button>
      </div>
    </div>

    <!-- Scan view -->
    <div id="scan" class="main scan hidden" aria-live="polite">
      <div class="toolbar">
        <div class="title" id="modeTitle">Mode</div>
        <div class="spacer"></div>
        <!-- Hardware Scanner toggle -->
        <button id="btnHID" class="btn ghost" title="Toggle hardware scanner (HID)">Hardware Scanner: Off</button>
        <button id="btnTorch" class="btn ghost" title="Toggle torch" aria-pressed="false" disabled>Torch</button>
        <button id="btnStop" class="btn ghost" title="Exit scanning">Exit</button>
      </div>

      <video id="preview" muted playsinline webkit-playsinline
             aria-label="Camera feed for barcode scanning"></video>

      <div class="frame" aria-hidden="true">
        <div class="corn tl"></div><div class="corn tr"></div><div class="corn bl"></div><div class="corn br"></div>
        <div class="line"></div>
      </div>

      <!-- Result sheet -->
      <div id="sheet" class="sheet" aria-atomic="true" role="alert">
        <div class="row">
          <span id="pill" class="pill">STATE</span>
          <button id="btnContinue" class="btn primary hidden">Continue</button>
        </div>
        <div id="sheetTitle" class="sheet-title">Result</div>
        <div id="sheetCode" class="sheet-code" aria-live="polite"></div>
      </div>

      <!-- toast -->
      <div id="toast" class="toast" role="status" aria-live="polite">Saved</div>
    </div>
  </div>

  <!-- Manual entry dialog -->
  <dialog id="manualDialog" aria-labelledby="manualTitle">
    <form method="dialog">
      <div id="manualTitle" class="modal-title">Manual entry</div>
      <label for="manualInput" class="sr-only">Enter baggage code</label>
      <input id="manualInput" type="text" placeholder="Enter code" aria-describedby="manualDesc"/>
      <div id="manualDesc" class="sr-only">Enter a 10 or 13-digit baggage code.</div>
      <div class="modal-actions">
        <button class="btn ghost" value="cancel">Cancel</button>
        <button id="manualApply" class="btn primary" value="ok">Apply</button>
      </div>
    </form>
  </dialog>

  <!-- NEW: Bag details dialog -->
  <dialog id="detailsDialog" aria-labelledby="detailsTitle">
    <form method="dialog" class="details-form">
      <div id="detailsTitle" class="modal-title">Bag details</div>
      <div class="grid2">
        <div>
          <label for="detailsDate">Date</label>
          <input id="detailsDate" type="date" />
        </div>
        <div>
          <label for="detailsFlight">Flight</label>
          <input id="detailsFlight" type="text" placeholder="Flight number" />
        </div>
      </div>
      <div class="grid2">
        <div>
          <label for="detailsClient">Client</label>
          <input id="detailsClient" list="clientList" placeholder="Client" />
        </div>
        <div class="summary-counters" aria-live="polite">
          <div><strong>Total Tags:</strong> <span id="cntTag">0</span></div>
          <div><strong>Retrieves:</strong> <span id="cntRetrieve">0</span></div>
          <div><strong>Matched:</strong> <span id="cntMatched">0</span></div>
          <div><strong>Unmatched:</strong> <span id="cntUnmatched">0</span></div>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" aria-label="Baggage scan records">
          <thead><tr><th>Time</th><th>Code</th><th>Type</th><th>Match?</th></tr></thead>
          <tbody id="detailsTbody"></tbody>
        </table>
      </div>

      <div class="modal-actions">
        <button type="button" id="btnExport" class="btn ghost">Export CSV</button>
        <button type="button" id="btnPrint" class="btn ghost">Print</button>
        <div class="spacer"></div>
        <button class="btn primary" value="ok">Close</button>
      </div>
    </form>
  </dialog>

  <!-- App JS -->
  <script src="app.js"></script>
</body>
</html>
